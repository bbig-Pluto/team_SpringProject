<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 
<mapper namespace="mapper.yyk">

	<!-- 다이어리 조회 -->
	<select id="diaryList" resultType="diaryDTO">
		SELECT d_title, d_content, d_fileName, d_weather, d_emotion, d_createTime, diaryNum, id
		FROM diary 
		where id = #{id}
		order by d_createTime desc
	</select>
	
<!-- 		<select id="diaryList" resultType="diaryDTO"> -->
<!-- 				SELECT d_title, d_content, d_fileName, d_weather, d_emotion, d_createTime, diaryNum -->
<!-- 				FROM diary  -->
<!-- 				order by d_createTime desc -->
<!-- 		</select> -->
	
	
	<!-- 다이어리 추가 -->
	<insert id="addDiary" parameterType="diaryDTO">
		insert into diary(d_title, d_content, d_fileName, d_weather, d_emotion, d_createTime, diaryNum, id)
		values(#{d_title}, #{d_content}, #{d_fileName}, #{d_weather}, #{d_emotion}, sysdate, seq_diaryNum.nextval, #{id})
	</insert>
	
	
	<!-- 다이어리 수정 -->
	<update id="updateDiary" parameterType="diaryDTO">
		update diary
		set d_title= #{d_title}, d_content= #{d_content}
		<if test = "d_fileName != '' and d_fileName != null">
			,d_fileName= #{d_fileName}
		</if>
		, d_weather= #{d_weather}, d_emotion=#{d_emotion}, d_createTime= sysdate
		where diaryNum= #{diaryNum}
	</update>
	
	
	<!-- 다이어리 삭제 -->
	<delete id="delDiary" parameterType="diaryDTO">
		delete from diary
		where diaryNum= #{diaryNum}
	</delete>
	
	
	<!-- 다이어리 검색 -->
	<select id="searchDiary" resultType="diaryDTO">
		SELECT d_title, d_content, d_createTime, diaryNum, id
		FROM diary
		where id = #{id}
		and lower(d_title) Like '%' || lower(#{d_title}) || '%' order by d_createTime desc
	</select>
	
	
	<!-- 메모장 내용 -->
	<select id="memoList" resultType="String">
		SELECT m_content
		FROM memo 
		where id = #{map.sessionId}
	</select>
	
	<select id="idCheck" resultType="String">
		SELECT NVL(count(*), 0) FROM (
			select count(id) 
			from memo 
			WHERE id = #{sessionId} GROUP BY id
			)
	</select>
	
	
	<!-- 메모장 추가 -->                                                    
	<insert id="addMemo" parameterType="Hashmap">
		insert into memo (m_content, id)
		values (#{m_content}, #{sessionId}) 
	</insert>
	
	
	<!-- 메모장 수정 -->
	<update id="updateMemo" parameterType="Hashmap">
		update memo
		set m_content= #{m_content}
		where id = #{sessionId}
	</update>

</mapper>